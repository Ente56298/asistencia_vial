<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Seguimiento - CO‚Ä¢RA</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0,0,0,0.9);
            border-radius: 25px;
            padding: 40px;
            border: 3px solid #2c3e50;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .title {
            color: #3498db;
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        .dashboard-card {
            background: rgba(52, 152, 219, 0.1);
            border: 2px solid #3498db;
            border-radius: 20px;
            padding: 25px;
        }
        .card-title {
            color: #3498db;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .mood-chart {
            width: 100%;
            height: 200px;
            background: rgba(0,0,0,0.6);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }
        .chart-line {
            position: absolute;
            bottom: 15px;
            left: 15px;
            right: 15px;
            height: 150px;
            background: linear-gradient(to right, #e74c3c 0%, #f39c12 50%, #27ae60 100%);
            border-radius: 5px;
            opacity: 0.3;
        }
        .mood-points {
            position: absolute;
            bottom: 15px;
            left: 15px;
            right: 15px;
            height: 150px;
        }
        .mood-point {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #3498db;
            border-radius: 50%;
            border: 2px solid #ffffff;
        }
        .quick-checkin {
            background: rgba(0,0,0,0.6);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }
        .mood-selector {
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            gap: 5px;
            margin: 15px 0;
        }
        .mood-btn {
            padding: 10px 5px;
            border: 2px solid #7f8c8d;
            border-radius: 8px;
            background: rgba(0,0,0,0.4);
            color: white;
            cursor: pointer;
            text-align: center;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        .mood-btn:hover {
            background: rgba(52, 152, 219, 0.3);
        }
        .mood-btn.selected {
            background: rgba(52, 152, 219, 0.5);
            border-color: #ffffff;
        }
        .autocuidado-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        .autocuidado-item {
            background: rgba(0,0,0,0.4);
            border: 2px solid #7f8c8d;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .autocuidado-item:hover {
            border-color: #27ae60;
        }
        .autocuidado-item.completed {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
        }
        .alert-status {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin: 15px 0;
        }
        .status-green {
            background: rgba(39, 174, 96, 0.2);
            border: 2px solid #27ae60;
            color: #27ae60;
        }
        .status-yellow {
            background: rgba(243, 156, 18, 0.2);
            border: 2px solid #f39c12;
            color: #f39c12;
        }
        .status-red {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
            color: #e74c3c;
        }
        .input-field {
            width: 100%;
            min-height: 40px;
            background: rgba(0,0,0,0.6);
            border: 2px solid #7f8c8d;
            border-radius: 8px;
            color: #ffffff;
            padding: 10px;
            font-size: 0.9rem;
        }
        .save-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 15px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }
        .save-btn:hover {
            transform: scale(1.05);
        }
        .sos-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .sos-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(231, 76, 60, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üìä Dashboard de Seguimiento CO‚Ä¢RA</h1>
            <p style="color: #74b9ff; margin-bottom: 20px;">
                Monitoreo continuo de bienestar y seguimiento personalizado
            </p>
            <div id="currentStatus" class="alert-status status-green">
                üü¢ Estado Actual: VERDE - Seguimiento Normal
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Check-in R√°pido -->
            <div class="dashboard-card">
                <h3 class="card-title">‚ö° Check-in R√°pido</h3>
                <div class="quick-checkin">
                    <p style="margin-bottom: 10px;"><strong>¬øC√≥mo te sientes ahora? (0-10)</strong></p>
                    <div class="mood-selector">
                        <div class="mood-btn" onclick="selectQuickMood(0)">0</div>
                        <div class="mood-btn" onclick="selectQuickMood(1)">1</div>
                        <div class="mood-btn" onclick="selectQuickMood(2)">2</div>
                        <div class="mood-btn" onclick="selectQuickMood(3)">3</div>
                        <div class="mood-btn" onclick="selectQuickMood(4)">4</div>
                        <div class="mood-btn" onclick="selectQuickMood(5)">5</div>
                        <div class="mood-btn" onclick="selectQuickMood(6)">6</div>
                        <div class="mood-btn" onclick="selectQuickMood(7)">7</div>
                        <div class="mood-btn" onclick="selectQuickMood(8)">8</div>
                        <div class="mood-btn" onclick="selectQuickMood(9)">9</div>
                        <div class="mood-btn" onclick="selectQuickMood(10)">10</div>
                    </div>
                    
                    <input type="text" id="quickNote" class="input-field" placeholder="Nota breve (50 caracteres m√°x.)" maxlength="50">
                    <button class="save-btn" onclick="saveQuickCheckin()">Guardar</button>
                </div>
            </div>

            <!-- Gr√°fico de Estado de √Ånimo -->
            <div class="dashboard-card">
                <h3 class="card-title">üìà Evoluci√≥n Semanal</h3>
                <div class="mood-chart">
                    <div class="chart-line"></div>
                    <div class="mood-points" id="moodChart">
                        <!-- Los puntos se generan din√°micamente -->
                    </div>
                    <div style="position: absolute; bottom: 0; left: 15px; right: 15px; display: flex; justify-content: space-between; font-size: 0.8rem; color: #7f8c8d;">
                        <span>Lun</span><span>Mar</span><span>Mi√©</span><span>Jue</span><span>Vie</span><span>S√°b</span><span>Dom</span>
                    </div>
                </div>
            </div>

            <!-- Rutina de Autocuidado -->
            <div class="dashboard-card">
                <h3 class="card-title">üå± Autocuidado Diario</h3>
                <div class="autocuidado-grid">
                    <div class="autocuidado-item" onclick="toggleAutocuidado('sleep')" id="sleep">
                        <div>üò¥</div>
                        <div>Sue√±o</div>
                        <div style="font-size: 0.8rem;">7+ horas</div>
                    </div>
                    <div class="autocuidado-item" onclick="toggleAutocuidado('exercise')" id="exercise">
                        <div>üèÉ</div>
                        <div>Ejercicio</div>
                        <div style="font-size: 0.8rem;">30+ min</div>
                    </div>
                    <div class="autocuidado-item" onclick="toggleAutocuidado('social')" id="social">
                        <div>üë•</div>
                        <div>Social</div>
                        <div style="font-size: 0.8rem;">Contacto</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <p style="margin-bottom: 10px;"><strong>Horas de sue√±o anoche:</strong></p>
                    <input type="number" id="sleepHours" class="input-field" min="0" max="24" step="0.5" placeholder="Ej: 7.5">
                </div>
                
                <button class="save-btn" onclick="saveAutocuidado()">Actualizar Rutina</button>
            </div>

            <!-- Seguimiento Cognitivo -->
            <div class="dashboard-card">
                <h3 class="card-title">üß† Seguimiento Cognitivo</h3>
                <div style="background: rgba(0,0,0,0.6); border-radius: 10px; padding: 15px; margin: 15px 0;">
                    <p style="margin-bottom: 15px;"><strong>Pr√≥xima evaluaci√≥n:</strong> <span id="nextCognitiveDate">En 2 semanas</span></p>
                    
                    <div style="margin: 15px 0;">
                        <h4 style="margin-bottom: 10px;">Autoevaluaci√≥n r√°pida:</h4>
                        <div style="display: grid; gap: 10px;">
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Concentraci√≥n (1-10):</span>
                                <input type="range" min="1" max="10" value="7" id="concentration" style="width: 100px;">
                                <span id="concentrationValue">7</span>
                            </label>
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Memoria (1-10):</span>
                                <input type="range" min="1" max="10" value="7" id="memory" style="width: 100px;">
                                <span id="memoryValue">7</span>
                            </label>
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Claridad mental (1-10):</span>
                                <input type="range" min="1" max="10" value="7" id="clarity" style="width: 100px;">
                                <span id="clarityValue">7</span>
                            </label>
                        </div>
                    </div>
                    
                    <button class="save-btn" onclick="saveCognitive()">Guardar Evaluaci√≥n</button>
                </div>
            </div>

            <!-- Alertas y Acciones -->
            <div class="dashboard-card">
                <h3 class="card-title">üö® Centro de Alertas</h3>
                <div id="alertsContainer">
                    <div style="background: rgba(0,0,0,0.6); border-radius: 10px; padding: 15px; margin: 10px 0;">
                        <p style="color: #27ae60; margin-bottom: 10px;">‚úÖ Sin alertas activas</p>
                        <p style="font-size: 0.9rem; color: #7f8c8d;">Contin√∫a con tu rutina de seguimiento</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <a href="protocolo_sos.html" class="sos-btn">üÜò PROTOCOLO SOS</a>
                </div>
            </div>

            <!-- Historial Reciente -->
            <div class="dashboard-card">
                <h3 class="card-title">üìã Historial Reciente</h3>
                <div id="recentHistory" style="background: rgba(0,0,0,0.6); border-radius: 10px; padding: 15px; margin: 15px 0; max-height: 200px; overflow-y: auto;">
                    <!-- El historial se carga din√°micamente -->
                </div>
                
                <button class="save-btn" onclick="exportData()">üìä Exportar Datos</button>
            </div>
        </div>
    </div>

    <script>
        let currentQuickMood = null;
        let autocuidadoStatus = { sleep: false, exercise: false, social: false };
        let followupData = JSON.parse(localStorage.getItem('followupData')) || {
            checkins: [],
            autocuidado: [],
            cognitive: []
        };

        function selectQuickMood(mood) {
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            currentQuickMood = mood;
            updateAlertStatus(mood);
        }

        function updateAlertStatus(mood) {
            const statusDiv = document.getElementById('currentStatus');
            
            if (mood <= 3) {
                statusDiv.className = 'alert-status status-red';
                statusDiv.innerHTML = 'üî¥ Estado Actual: ROJO - Protocolo SOS Recomendado';
                showAlert('ALERTA ROJA: Se recomienda activar el protocolo SOS', 'red');
            } else if (mood <= 6) {
                statusDiv.className = 'alert-status status-yellow';
                statusDiv.innerHTML = 'üü° Estado Actual: AMARILLO - Precauci√≥n y Apoyo';
                showAlert('ALERTA AMARILLA: Considera contactar tu red de apoyo', 'yellow');
            } else {
                statusDiv.className = 'alert-status status-green';
                statusDiv.innerHTML = 'üü¢ Estado Actual: VERDE - Seguimiento Normal';
                clearAlerts();
            }
        }

        function showAlert(message, type) {
            const alertsContainer = document.getElementById('alertsContainer');
            const colors = {
                red: '#e74c3c',
                yellow: '#f39c12',
                green: '#27ae60'
            };
            
            alertsContainer.innerHTML = `
                <div style="background: rgba(0,0,0,0.6); border: 2px solid ${colors[type]}; border-radius: 10px; padding: 15px; margin: 10px 0;">
                    <p style="color: ${colors[type]}; margin-bottom: 10px; font-weight: bold;">${message}</p>
                    <p style="font-size: 0.9rem; color: #7f8c8d;">Registrado: ${new Date().toLocaleString()}</p>
                </div>
            `;
        }

        function clearAlerts() {
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = `
                <div style="background: rgba(0,0,0,0.6); border-radius: 10px; padding: 15px; margin: 10px 0;">
                    <p style="color: #27ae60; margin-bottom: 10px;">‚úÖ Sin alertas activas</p>
                    <p style="font-size: 0.9rem; color: #7f8c8d;">Contin√∫a con tu rutina de seguimiento</p>
                </div>
            `;
        }

        function saveQuickCheckin() {
            if (currentQuickMood === null) {
                alert('Por favor selecciona tu estado de √°nimo');
                return;
            }

            const note = document.getElementById('quickNote').value;
            const checkin = {
                mood: currentQuickMood,
                note: note,
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString()
            };

            followupData.checkins.push(checkin);
            localStorage.setItem('followupData', JSON.stringify(followupData));
            
            updateMoodChart();
            updateHistory();
            
            alert('‚úÖ Check-in guardado correctamente');
            
            // Limpiar formulario
            document.getElementById('quickNote').value = '';
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            currentQuickMood = null;
        }

        function toggleAutocuidado(type) {
            autocuidadoStatus[type] = !autocuidadoStatus[type];
            const element = document.getElementById(type);
            
            if (autocuidadoStatus[type]) {
                element.classList.add('completed');
            } else {
                element.classList.remove('completed');
            }
        }

        function saveAutocuidado() {
            const sleepHours = document.getElementById('sleepHours').value;
            
            const autocuidado = {
                sleep: autocuidadoStatus.sleep,
                exercise: autocuidadoStatus.exercise,
                social: autocuidadoStatus.social,
                sleepHours: parseFloat(sleepHours) || 0,
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString()
            };

            followupData.autocuidado.push(autocuidado);
            localStorage.setItem('followupData', JSON.stringify(followupData));
            
            alert('‚úÖ Rutina de autocuidado actualizada');
        }

        function saveCognitive() {
            const concentration = document.getElementById('concentration').value;
            const memory = document.getElementById('memory').value;
            const clarity = document.getElementById('clarity').value;
            
            const cognitive = {
                concentration: parseInt(concentration),
                memory: parseInt(memory),
                clarity: parseInt(clarity),
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString()
            };

            followupData.cognitive.push(cognitive);
            localStorage.setItem('followupData', JSON.stringify(followupData));
            
            alert('‚úÖ Evaluaci√≥n cognitiva guardada');
        }

        function updateMoodChart() {
            const chartContainer = document.getElementById('moodChart');
            const recentCheckins = followupData.checkins.slice(-7); // √öltimos 7 d√≠as
            
            chartContainer.innerHTML = '';
            
            recentCheckins.forEach((checkin, index) => {
                const point = document.createElement('div');
                point.className = 'mood-point';
                point.style.left = `${(index / 6) * 100}%`;
                point.style.bottom = `${(checkin.mood / 10) * 150}px`;
                point.title = `${checkin.date}: ${checkin.mood}/10`;
                chartContainer.appendChild(point);
            });
        }

        function updateHistory() {
            const historyContainer = document.getElementById('recentHistory');
            const recentEntries = [
                ...followupData.checkins.slice(-3).map(c => ({
                    type: 'Check-in',
                    data: `Estado: ${c.mood}/10 - ${c.note}`,
                    date: c.date
                })),
                ...followupData.autocuidado.slice(-2).map(a => ({
                    type: 'Autocuidado',
                    data: `Sue√±o: ${a.sleepHours}h, Ejercicio: ${a.exercise ? 'S√≠' : 'No'}`,
                    date: a.date
                }))
            ].sort((a, b) => new Date(b.date) - new Date(a.date));

            historyContainer.innerHTML = recentEntries.map(entry => `
                <div style="margin: 10px 0; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 8px;">
                    <strong>${entry.type}</strong> - ${entry.date}<br>
                    <span style="font-size: 0.9rem; color: #74b9ff;">${entry.data}</span>
                </div>
            `).join('');
        }

        function exportData() {
            const dataStr = JSON.stringify(followupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `seguimiento_cora_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        // Actualizar valores de sliders en tiempo real
        document.getElementById('concentration').oninput = function() {
            document.getElementById('concentrationValue').textContent = this.value;
        };
        document.getElementById('memory').oninput = function() {
            document.getElementById('memoryValue').textContent = this.value;
        };
        document.getElementById('clarity').oninput = function() {
            document.getElementById('clarityValue').textContent = this.value;
        };

        // Inicializar dashboard
        window.onload = function() {
            updateMoodChart();
            updateHistory();
            
            // Cargar estado de autocuidado del d√≠a
            const today = new Date().toLocaleDateString();
            const todayAutocuidado = followupData.autocuidado.find(a => a.date === today);
            if (todayAutocuidado) {
                Object.keys(autocuidadoStatus).forEach(key => {
                    if (todayAutocuidado[key]) {
                        autocuidadoStatus[key] = true;
                        document.getElementById(key).classList.add('completed');
                    }
                });
                document.getElementById('sleepHours').value = todayAutocuidado.sleepHours || '';
            }
        };
    </script>
    <script src="token_manager.js"></script>
    <script src="analytics_engine.js"></script>
</body>
</html>